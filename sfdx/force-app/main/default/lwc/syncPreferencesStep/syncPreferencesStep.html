<template>
    <div class="slds-p-around_large">
        <div class="stripe-settings__item slds-grid">
            <div class="slds-col_bump-right">
                <h4 class="slds-text-heading_small slds-m-bottom_xx-small">
                    Stripe Account
                </h4>
                <p>
                    The Stripe account connected to Salesforce. This account contains Stripe data being synced from your Salesforce account.
                </p>
            </div>
            <div class="slds-col slds-p-left_xx-large slds-size_1-of-3">
                <lightning-input type="text" label="Stripe Account" value={stripeAccountId} variant="label-hidden" placeholder="No Stripe Account Found" disabled></lightning-input>
            </div>
        </div>

        <div if:true={setupComplete} class="stripe-settings__item slds-grid">
            <div class="slds-col_bump-right">
                <h4 class="slds-text-heading_small slds-m-bottom_xx-small">
                    Last Synced
                </h4>
                <p>
                    The last time Stripe data was synced with this Salesforce org.
                </p>
            </div>
            <div class="slds-col slds-p-left_xx-large slds-size_1-of-3">
                <lightning-input label="Last Synced" type="text" variant="label-hidden" value={lastSynced} placeholder="N/A" disabled></lightning-input>
            </div>
        </div>

        <div class="stripe-settings__item slds-grid">
            <div class="slds-col_bump-right">
                <h4 class="slds-text-heading_small slds-m-bottom_xx-small">
                    Default Currency
                </h4>
                <p>
                    Currency to be used for Salesforce data being synced with Stripe. If multiple currencies are enabled in your Salesforce org, select the default currency from the list of currencies enabled in your org. This setting defaults to the default currency set in your org.
                </p>
            </div>
            <div class="slds-col slds-p-left_xx-large slds-size_1-of-3">
                <c-picklist if:true={isMultiCurrencyEnabled} label="Default Currency" options={currencyOptions} variant="label-hidden" value={defaultCurrency} onselect={updateDefaultCurrency} placeholder="Select Default Currency..." searchable></c-picklist>
                <lightning-input if:false={isMultiCurrencyEnabled} type="text" label="Default Currency" value={defaultCurrency} variant="label-hidden" placeholder="N/A" disabled></lightning-input>
            </div>
        </div>

        <div class="stripe-settings__item slds-grid">
            <div class="slds-col_bump-right">
                <h4 class="slds-text-heading_small slds-m-bottom_xx-small">
                    Sync Record Retention
                </h4>
                <p>
                    The number of sync records retained in your Salesforce org. A sync record is created each time Stripe data is synced with Salesforce.
                </p>
            </div>
            <div class="slds-col slds-p-left_xx-large slds-size_1-of-3">
                <lightning-input label="Sync Record Retention" type="number" variant="label-hidden" value={syncRecordRetention} onchange={updateSyncRecordRetention} placeholder="Enter a Value..." max="1000000" min="100" step="1"></lightning-input>
                <div class="slds-text-title slds-m-top_xx-small slds-p-left_xx-small">
                    Max 1,000,000 records, min 100 records
                </div>
            </div>
        </div>

        <div class="stripe-settings__item slds-grid">
            <div class="slds-col_bump-right">
                <h4 class="slds-text-heading_small slds-m-bottom_xx-small">
                    Sync Start Date
                </h4>
                <p>
                    The date on which Stripe data will begin syncing with Salesforce. This setting is progressive, meaning all relevant data from this date moving forward will be synced, while any data before the specified date will be ignored.
                </p>
            </div>
            <div class="slds-col slds-p-left_xx-large slds-size_1-of-3">
                <lightning-input label="Sync Start Date" type="date" date-style="short" variant="label-hidden" value={syncStartDate} onchange={updateSyncStartDate} placeholder="Select Sync Start Date..."></lightning-input>
            </div>
        </div>

        <div class="stripe-settings__item slds-grid">
            <div class="slds-col_bump-right">
                <h4 class="slds-text-heading_small slds-m-bottom_xx-small">
                    API Percentage Limit (%)
                </h4>
                <p>
                    The maximum percent of all available Salesforce API calls to be allocated to Stripe. Salesforce orgs have a limited number of API calls in a 24 hour period of time. If there are other call-intensive processes, consider reducing this setting to avoid hitting the org API limits.
                </p>
            </div>
            <div class="slds-col slds-p-left_xx-large slds-size_1-of-3">
                <lightning-input label="API Percentage Limit (%)" type="number" formatter="percent-fixed" step="1" min="1" max="100" variant="label-hidden" value={apiPercentageLimit} onchange={updateApiPercentageLimit} placeholder="Set API Limit (%)..."></lightning-input>
                <div class="slds-text-title slds-m-top_xx-small slds-p-left_xx-small">
                    Allowing {apiLimitCount} of {totalApiCalls} available API calls
                </div>
            </div>
        </div>
        <div if:true={isCpqInstalled} class="stripe-settings__item slds-grid">
            <div class="slds-col_bump-right">
                <h4 class="slds-text-heading_small slds-m-bottom_xx-small">
                    CPQ Term Unit
                </h4>
                <p>
                    The unit of time used for subscription terms in your org. This value can be found in the <a href="/lightning/setup/ImportedPackage/home" target="_blank">Installed Packages <lightning-icon icon-name="utility:new_window" class="stripe-icon_inline slds-current-color" size="xx-small"></lightning-icon></a> section of your Salesforce Org Setup. Find the Salesforce CPQ package, click 'Configure' next to the package name, and navigate to 'Subscriptions and Renewals'. The 'Subscription Term Unit' is the value needed for this setting.
                </p>
            </div>
            <div class="slds-col slds-p-left_xx-large slds-size_1-of-3">
                <c-picklist label="CPQ Term Interval" options={intervalOptions} variant="label-hidden" value={cpqTermUnit} onselect={updateCpqTermInterval} placeholder="Select Interval..." searchable></c-picklist>
            </div>
        </div>
        <div class="stripe-settings__item slds-grid">
            <div class="slds-col_bump-right">
                <h4 class="slds-text-heading_small slds-m-bottom_xx-small">
                    Custom Order Sync Conditions
                </h4>
                <p>
                    By default, all activated Orders will be synchronized to Stripe. To filter out additional orders, specify a SOQL <code>WHERE</code> clause here.
                    This custom query determines which Orders will be synchronized. Orders that do not meet the criteria defined here are excluded from the sync to Stripe.
                </p>
            </div>
            <div class="slds-col slds-p-left_xx-large slds-size_1-of-3">
                <lightning-input label="Include Order records where:" type="text" value={orderFilter} placeholder="Provide filter logic..." class={orderFilterClassList} onchange={updateOrderFilter}></lightning-input>
                <div if:true={hasOrderFilterError} class="slds-form-element__help slds-text-color_error">
                    {orderFilterError}
                </div>
            </div>
        </div>
        <div class="stripe-settings__item slds-grid">
            <div class="slds-col_bump-right">
                <h4 class="slds-text-heading_small slds-m-bottom_xx-small">
                    Custom Account Sync Conditions
                </h4>
                <p>
                    If ongoing account updates is enabled on your account, account updates are synchronized to Stripe. To customize which types of accounts are kept up-to-date in Stripe, specify a SOQL <code>WHERE</code> clause here.
                    This custom query determines which accounts will be synchronized. Accounts that do not meet the criteria defined here are excluded from the sync to Stripe.
                </p>
            </div>
            <div class="slds-col slds-p-left_xx-large slds-size_1-of-3">
                <lightning-input label="Include Account records where:" type="text" value={accountFilter} placeholder="Provide filter logic..." class={accountFilterClassList} onchange={updateAccountFilter}></lightning-input>
                <div if:true={hasAccountFilterError} class="slds-form-element__help slds-text-color_error">
                    {accountFilterError}
                </div>
            </div>
        </div>
        <div class="stripe-settings__item slds-grid">
            <div class="slds-col_bump-right">
                <h4 class="slds-text-heading_small slds-m-bottom_xx-small">
                    Custom Product Sync Conditions
                </h4>
                <p>
                    If products or pricebooks are manually synced using the button below, all products are synced to Stripe. To customize which products are synced to Stripe, specify a SOQL <code>WHERE</code> clause here.
                    This custom query determines which products will be synchronized when the "Sync All Products" or "Sync All Pricebooks" button is pressed below. Products that do not meet the criteria defined here are excluded from the sync to Stripe.
                    This conditional will <strong>not</strong> limit which products connected to an activated order are synced.
                </p>
            </div>
            <div class="slds-col slds-p-left_xx-large slds-size_1-of-3">
                <lightning-input label="Include Product records where:" type="text" value={productFilter} placeholder="Provide filter logic..." class={productFilterClassList} onchange={updateProductFilter}></lightning-input>
                <div if:true={hasProductFilterError} class="slds-form-element__help slds-text-color_error">
                    {productFilterError}
                </div>
            </div>
        </div>

        <div if:true={isSandbox} class="stripe-settings__item slds-grid">
            <div class="slds-col_bump-right">
                <h4 class="slds-text-heading_small slds-m-bottom_xx-small">
                    Sync All Pricebooks
                </h4>
                <p>
                    Initiate a sync of all products AND pricebooks in Salesforce to your Stripe account. This process will run in the background and can take a few minutes to complete depending on the number of products and pricebooks present. All products and pricebooks will be synced regardless of how recently they were updated. Be aware that products and pricebooks in Stripe will NOT be deleted or archived if they have been deleted in Salesforce.
                </p>
            </div>
            <div class="slds-col slds-p-left_xx-large slds-size_1-of-3 slds-text-align_right">
                <lightning-button label="Sync Pricebooks" variant="neutral" icon-name="utility:sync" icon-position="left" onclick={showPricebookSyncModal} disabled={syncPricebooksDisabled}></lightning-button>
            </div>
        </div>

        <div if:true={isSandbox} class="stripe-settings__item slds-grid">
            <div class="slds-col_bump-right">
                <h4 class="slds-text-heading_small slds-m-bottom_xx-small">
                    Sync All Products
                </h4>
                <p>
                    Initiate a sync of all products in Salesforce to your Stripe account. This process will run in the background and can take a few minutes to complete depending on the number of products present. All products will be synced regardless of how recently they were updated. Be aware that products in Stripe will NOT be deleted or archived if they have been deleted in Salesforce.
                </p>
            </div>
            <div class="slds-col slds-p-left_xx-large slds-size_1-of-3 slds-text-align_right">
                <lightning-button label="Sync Products" variant="neutral" icon-name="utility:sync" icon-position="left" onclick={showProductSyncModal} disabled={syncProductsDisabled}></lightning-button>
            </div>
        </div>
    </div>

<!-- Manual Sync Confirmation Modals -->
<c-modal class="stripe-modal_product-sync" title="Sync All Products">
    <p class="slds-text-align_center">
        Are you sure you want to sync all products in your Salesforce org with your Stripe account? This process may take some time to complete and cannot be stopped once initiated.
    </p>
    <lightning-button slot="footer" label="Cancel" variant="neutral" class="slds-button" onclick={hideProductSyncModal}></lightning-button>
    <lightning-button slot="footer" label="Sync All Products" variant="brand" class="slds-button" onclick={syncProducts}></lightning-button>
</c-modal>

<c-modal class="stripe-modal_pricebook-sync" title="Sync All Pricebooks">
    <p class="slds-text-align_center">
        Are you sure you want to sync all pricebooks in your Salesforce org with your Stripe account? Syncing all pricebooks will also sync all products with your Stripe account. This process may take some time to complete and cannot be stopped once initiated.
    </p>
    <lightning-button slot="footer" label="Cancel" variant="neutral" class="slds-button" onclick={hidePricebookSyncModal}></lightning-button>
    <lightning-button slot="footer" label="Sync All Pricebooks" variant="brand" class="slds-button" onclick={syncPricebooks}></lightning-button>
</c-modal>
<!-- /Manual Sync Confirmation Modals -->
</template>